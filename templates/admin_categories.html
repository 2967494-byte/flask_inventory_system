{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <div class="admin-header">
        <h1 class="page-title">üìä –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏</h1>
        <p class="admin-subtitle">–ó–∞–≥—Ä—É–∑–∫–∞ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ —Ç–æ–≤–∞—Ä–æ–≤</p>
    </div>

    <div class="admin-content">
        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div class="stats-cards">
            <div class="stat-card">
                <div class="stat-number">{{ categories|length }}</div>
                <div class="stat-label">–í—Å–µ–≥–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–π</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">{{ parent_categories|length }}</div>
                <div class="stat-label">–†–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏—Ö</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">{{ categories|length - parent_categories|length }}</div>
                <div class="stat-label">–î–æ—á–µ—Ä–Ω–∏—Ö</div>
            </div>
        </div>

        <!-- –ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π -->
        <div class="upload-section">
            <h3>üìÅ –ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏–∑ JSON</h3>
            <div class="upload-card">
                <form method="POST" action="{{ url_for('main.upload_categories') }}" enctype="multipart/form-data">
                    <div class="form-group">
                        <label class="form-label">–í—ã–±–µ—Ä–∏—Ç–µ JSON —Ñ–∞–π–ª —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏:</label>
                        <input type="file" name="categories_file" accept=".json" class="form-control" required>
                        <small class="form-text">–§–∞–π–ª –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∞—Å—Å–∏–≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Å –ø–æ–ª—è–º–∏ name, description –∏ children</small>
                    </div>
                    <button type="submit" class="btn-primary">üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</button>
                </form>
            </div>
        </div>

        <!-- –û—á–∏—Å—Ç–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π -->
        <div class="danger-section">
            <h3>‚ö†Ô∏è –û–ø–∞—Å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h3>
            <div class="danger-card">
                <p>–£–¥–∞–ª–∏—Ç—å –≤—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (–≤–∫–ª—é—á–∞—è —Ç–æ–≤–∞—Ä—ã –≤ –Ω–∏—Ö)</p>
                <form method="POST" action="{{ url_for('main.clear_categories') }}" onsubmit="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã? –í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã!')">
                    <button type="submit" class="btn-danger">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</button>
                </form>
            </div>
        </div>

        <!-- –°–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π -->
        <div class="categories-list">
            <h3>üìÇ –¢–µ–∫—É—â–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</h3>
            {% if categories %}
                <div class="categories-tree">
                    {% for parent in parent_categories %}
                    <div class="parent-category">
                        <strong>üìÅ {{ parent.name }}</strong>
                        {% if parent.description %}
                        <br><small class="text-muted">{{ parent.description }}</small>
                        {% endif %}
                        
                        {% set children = categories|selectattr('parent_id', 'equalto', parent.id)|list %}
                        {% if children %}
                        <div class="children-categories">
                            {% for child in children %}
                            <div class="child-category">
                                üìÑ {{ child.name }}
                                {% if child.description %}
                                <br><small class="text-muted">{{ child.description }}</small>
                                {% endif %}
                            </div>
                            {% endfor %}
                        </div>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="empty-state">
                    <p>üì≠ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –µ—â–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã</p>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<style>
.admin-header {
    background: linear-gradient(135deg, var(--avito-blue) 0%, var(--avito-blue-hover) 100%);
    color: white;
    padding: 32px;
    border-radius: 12px;
    margin-bottom: 24px;
    text-align: center;
}

.admin-header .page-title {
    color: white;
    margin-bottom: 8px;
}

.admin-subtitle {
    opacity: 0.9;
}

.stats-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 16px;
    margin-bottom: 32px;
}

.stat-card {
    background: white;
    padding: 20px;
    border-radius: 8px;
    text-align: center;
    border: 1px solid var(--border);
    box-shadow: var(--shadow-light);
}

.stat-number {
    font-size: 32px;
    font-weight: bold;
    color: var(--avito-blue);
}

.stat-label {
    color: var(--text-secondary);
    font-size: 14px;
}

.upload-section, .danger-section, .categories-list {
    background: white;
    padding: 24px;
    border-radius: 12px;
    border: 1px solid var(--border);
    margin-bottom: 24px;
    box-shadow: var(--shadow-light);
}

.upload-card, .danger-card {
    background: var(--background-secondary);
    padding: 20px;
    border-radius: 8px;
    border: 1px solid var(--border-light);
}

.btn-danger {
    background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: var(--radius);
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s ease;
}

.btn-danger:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(245, 87, 108, 0.3);
}

.categories-tree {
    display: flex;
    flex-direction: column;
    gap: 16px;
}

.parent-category {
    background: var(--avito-blue-light);
    padding: 16px;
    border-radius: 8px;
    border-left: 4px solid var(--avito-blue);
}

.children-categories {
    margin-left: 20px;
    margin-top: 12px;
}

.child-category {
    background: var(--background-secondary);
    padding: 12px;
    border-radius: 6px;
    margin-bottom: 8px;
    border-left: 2px solid var(--text-tertiary);
}

.empty-state {
    text-align: center;
    padding: 40px;
    color: var(--text-secondary);
}
</style>
{% endblock %}